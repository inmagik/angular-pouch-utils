/*!
 * angular-pouch-utils
 * 
 * Version: 0.1.0 - 2014-10-27T11:00:06.767Z
 * License: 
 */
!function(){"use strict";angular.module("pouchUtils",[]).factory("pouchService",["$q",function(e){var r={};return r.getDocListFactory=function(r){return function(t){var n={include_docs:!0,conflicts:!0},c=_.extend(n,t||{}),o=e.defer();return r.allDocs(c,function(e,r){if(e)return void o.reject(e);var t=c.include_docs?_.pluck(r.rows,"doc"):r.rows;o.resolve(t)}),o.promise}},r.wrapQuery=function(r,t,n){var c={include_docs:!0,conflicts:!0},o=_.extend(c,n||{}),u=e.defer();return r.query(t,o,function(e,r){e&&u.reject(e);var t=o.include_docs?_.pluck(r.rows,"doc"):r.rows;u.resolve(t)}),u.promise},r.queryFactory=function(e){return function(t,n){return r.wrapQuery(e,t,n)}},r.filterFactory=function(e){return function(t,n){var c=function(e,r){t(e)&&r(e._id)};return r.wrapQuery(e,{map:c},n)}},r.rejectFactory=function(e){return function(t,n){var c=function(e,r){t(e)||r(e._id)};return r.wrapQuery(e,{map:c},n)}},r.whereFactory=function(e){return function(t,n){var c=_.matches(t),o=function(e,r){c(e)&&r(e._id)};return r.wrapQuery(e,{map:o},n)}},r.whereNotFactory=function(e){return function(t,n){var c=_.matches(t),o=function(e,r){c(e)||r(e._id)};return r.wrapQuery(e,{map:o},n)}},r.getDocFactory=function(r){return function(t,n){var c=e.defer(),o=_.extend({conflicts:!0},n||{});return r.get(t,o,function(e,r){e&&c.reject(e),c.resolve(r)}),c.promise}},r.saveDocFactory=function(r){return function(t){var n=e.defer();return t._id&&t._rev?r.put(t,t._id,t._rev).then(function(e){t._rev=e.rev,n.resolve(t)}).catch(function(e){n.reject(e)}):r.post(t,t._id).then(function(e){t._id=e.id,t._rev=e.rev,n.resolve(t)}).catch(function(e){n.reject(e)}),n.promise}},r.deleteDocFactory=function(r){return function(t,n){var c=e.defer();return r.remove(t,n,function(e,r){e&&c.reject(e),c.resolve(r)}),c.promise}},r.createDesignDoc=function(e,r){var t={_id:"_design/"+e,views:{}};return t.views[e]={},r.map&&(t.views[e].map=r.map.toString()),r.reduce&&(t.views[e].reduce=r.reduce.toString()),t},r.createFilterDoc=function(e,r){var t={_id:"_design/"+e,filters:{name:r.toString()}};return t},r.putDesignDocFactory=function(r){return function(t,n){var c=e.defer();return n=n||"views",r.get(t._id,function(e,o){if(e);else{if(angular.equals(t[n],o[n]))return void c.resolve(o);t._rev=o._rev}r.put(t,function(e,t){e&&("conflict"==e.name&&c.resolve(t),c.reject(e)),r.query(name,{stale:"update_after"}),c.resolve(t)})}),c.promise}},r.getDBManager=function(e){return{get:r.getDocFactory(e),save:r.saveDocFactory(e),"delete":r.deleteDocFactory(e),all:r.getDocListFactory(e),query:r.queryFactory(e),filter:r.filterFactory(e),reject:r.rejectFactory(e),where:r.whereFactory(e),whereNot:r.whereNotFactory(e),putDesign:r.putDesignDocFactory(e)}},r}])}();