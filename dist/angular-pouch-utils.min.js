/*!
 * angular-pouch-utils
 * 
 * Version: 0.1.0 - 2014-10-21T22:49:52.260Z
 * License: 
 */
!function(){"use strict";angular.module("pouchUtils",[]).factory("pouchService",["$q",function(e){function r(e,r){var t={_id:"_design/"+e,views:{}};return t.views[e]={},r.map&&(t.views[e].map=r.map.toString()),r.reduce&&(t.views[e].reduce=r.reduce.toString()),t}var t={};return t.getDocListFactory=function(r){return function(t){var n={include_docs:!0},c=_.extend(n,t||{}),o=e.defer();return r.allDocs(c,function(e,r){e&&o.reject(e);var t=c.include_docs?_.pluck(r.rows,"doc"):r.rows;o.resolve(t)}),o.promise}},t.wrapQuery=function(r,t,n){var c={include_docs:!0},o=_.extend(c,n||{}),u=e.defer();return r.query(t,o,function(e,r){e&&u.reject(e);var t=o.include_docs?_.pluck(r.rows,"doc"):r.rows;u.resolve(t)}),u.promise},t.queryFactory=function(e){return function(r,n){return t.wrapQuery(e,r,n)}},t.filterFactory=function(e){return function(r,n){var c=function(e,t){r(e)&&t(e._id)};return t.wrapQuery(e,{map:c},n)}},t.rejectFactory=function(e){return function(r,n){var c=function(e,t){r(e)||t(e._id)};return t.wrapQuery(e,{map:c},n)}},t.whereFactory=function(e){return function(r,n){var c=_.matches(r),o=function(e,r){c(e)&&r(e._id)};return t.wrapQuery(e,{map:o},n)}},t.whereNotFactory=function(e){return function(r,n){var c=_.matches(r),o=function(e,r){c(e)||r(e._id)};return t.wrapQuery(e,{map:o},n)}},t.getDocFactory=function(r){return function(t,n){var c=e.defer(),o=_.extend({},n||{});return r.get(t,o,function(e,r){e&&c.reject(e),c.resolve(r)}),c.promise}},t.saveDocFactory=function(r){return function(t){var n=e.defer();return t._id&&t._rev?r.put(t,t._id,t._rev).then(function(e){t._rev=e.rev,n.resolve(t)}).catch(function(e){n.reject(e)}):r.post(t,t._id).then(function(e){t._id=e.id,t._rev=e.rev,n.resolve(t)}).catch(function(e){n.reject(e)}),n.promise}},t.deleteDocFactory=function(r){return function(t,n){var c=e.defer();return r.remove(t,n,function(e,r){e&&c.reject(e),c.resolve(r)}),c.promise}},t.putDesignDocFactory=function(t){return function(n,c){var o=e.defer(),u=r(n,c);return t.put(u,function(e,r){e&&("conflict"==e.name&&o.resolve(r),o.reject(e)),t.query(n,{stale:"update_after"}),o.resolve(r)}),o.promise}},t.getDBManager=function(e){return{get:t.getDocFactory(e),save:t.saveDocFactory(e),"delete":t.deleteDocFactory(e),all:t.getDocListFactory(e),query:t.queryFactory(e),filter:t.filterFactory(e),reject:t.rejectFactory(e),where:t.whereFactory(e),whereNot:t.whereNotFactory(e),putDesign:t.putDesignDocFactory(e)}},t}])}();